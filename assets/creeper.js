(function(q){"undefined"===typeof Uint8ClampedArray&&(Uint8ClampedArray=Uint8Array);var g,r,f={convolute:function(a,f,t,d){d=d||!0;var h=Math.round(Math.sqrt(f.length)),v=Math.floor(h/2),w=g,q=r,e=new Uint8ClampedArray(a.length);d=d?1:0;for(var k=0;k<r;k++)for(var l=0;l<g;l++){for(var A=k,B=l,m=4*(k*g+l),x=0,y=0,z=0,u=0,n=0;n<h;n++)for(var p=0;p<h;p++){var b=A+n-v,c=B+p-v;0<=b&&b<q&&0<=c&&c<w&&(b=4*(b*w+c),c=f[n*h+p],x+=a[b]*c,y+=a[b+1]*c,z+=a[b+2]*c,u+=a[b+3]*c)}e[m]=t+x;e[m+1]=t+y;e[m+2]=t+z;e[m+
  3]=u+d*(255-u)}return e}};q.onmessage=function(a){a=a.data;switch(a.type){case "init":g=a.w;r=a.h;break;case "convolute":this.postMessage(f.convolute(a.data,a.matrix,a.offset,a.opaque));break;default:this.postMessage(f[a.type](a))}}})(this);
